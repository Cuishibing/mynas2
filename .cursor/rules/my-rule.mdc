---
description: 
globs: 
alwaysApply: true
---
# MyNAS 项目规范

## 项目概述
MyNAS 是一个基于 Web 的图片管理系统，主要用于 iOS 设备上的图片上传和管理。

## 技术栈
### 前端 (mynas_front)
- 纯 HTML5 技术栈
- 无框架依赖
- 主要运行在 iOS 设备上
- 使用原生 JavaScript ES6+ 模块化开发

### 后端 (mynas_service)
- Node.js 技术栈
- Express.js 作为 Web 框架
- Multer 处理文件上传
- Sharp 处理图片缩略图
- 使用文件系统存储图片和元数据

## 核心功能
1. 图片上传
   - 支持选择图片上传到后端
   - 自动检查重复上传
   - 支持大文件上传（最大 50MB）
   - 自动生成缩略图

2. 图片展示
   - 分页加载图片列表
   - 懒加载优化
   - 自动生成缩略图
   - 支持图片加载失败重试

3. 数据持久化
   - 图片文件存储在服务器文件系统
   - 图片元数据保存在远程 DB 文件
   - 每张图片记录包含：文件名、大小、类型、MD5

## 代码结构
### 前端结构
```
mynas_front/
├── src/
│   ├── js/
│   │   └── gallery.js    # 图片展示核心逻辑
│   ├── css/
│   │   └── styles.css    # 样式文件
│   └── index.html        # 主页面
```

### 后端结构
```
mynas_service/
├── index.js              # 主服务入口
├── uploads/             # 图片存储目录
│   └── thumbnails/      # 缩略图存储目录
└── package.json         # 项目依赖配置
```

## API 接口
1. 获取图片列表
   - GET /api/images
   - 支持分页参数：page, pageSize
   - 返回：图片列表、总数、分页信息

2. 上传图片
   - POST /api/images/upload
   - 支持文件上传
   - 返回：上传结果、文件信息

3. 检查图片
   - GET /api/images/check/:filename
   - 检查图片是否已存在

## 性能优化
1. 图片加载
   - 使用缩略图加速加载
   - 实现懒加载
   - 支持加载失败重试

2. 服务器优化
   - 静态文件缓存
   - CORS 配置
   - 文件大小限制

## 安全措施
1. 文件上传
   - 文件类型限制
   - 文件大小限制
   - 文件名验证

2. 访问控制
   - CORS 配置
   - 错误处理
   - 请求日志

## 开发规范
1. 代码风格
   - 使用 ES6+ 语法
   - 模块化开发
   - 异步操作使用 async/await

2. 错误处理
   - 统一的错误处理机制
   - 详细的错误日志
   - 用户友好的错误提示

3. 注释规范
   - 关键功能添加注释
   - 复杂逻辑说明
   - API 接口文档
要实现的能力如下：
1、可以选择图片上传到后端，已经上传过图片不用上传
2、进入后首先展示已经上传的图片